<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Your Session</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-image: url('https://github.com/JSPOON3R/JSPOON3R.github.io/blob/main/resources-common/images/vector_wallpaper.jpg?raw=true');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: #f0f0f0;
        }

        .container {
            text-align: center;
            background-color: rgba(44, 44, 44, 0.98);
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            width: 35%;
            max-width: 90%;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: lighter;
            color: #61dafb;
        }

        h2 {
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: lighter;
            color: #a8a8a8;
        }

        p {
            margin:0;
        }

        .steps {
            display: none; /* Initially hide the steps */
            flex-direction: column;
            align-items: flex-start;
            margin: 0 auto;
            margin-bottom: 20px;
            padding: 15px 25px;
            font-size: 18px;
            font-weight: 300;
            background-color: rgba(60, 60, 60, 0.9);            
            border-radius: 8px;
            color: #d4d4d4; 
            width: fit-content;
        }

        .step-item {
            display: flex;
            align-items: center;
            margin: 5px 0; /* Reduced spacing between steps */
            line-height: 1.4; /* Slightly tighter line height */
        }

        .step-item span {
            color: #61dafb;
            font-weight: bold;
            text-align: right;
            margin-right: 10px;
        }

        .disclaimer {
            margin-bottom: 20px;
            font-size: 15px;
            background-color: rgba(60, 60, 60, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
            font-weight: lighter;
            color: #d4d4d4;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .input-field, .button {
            width: 100%;
            max-width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .input-field {
            border: 1px solid #444;
            background-color: #2c2c2c;
            color: #f0f0f0;
            text-align: center;
            margin-bottom: 15px;
        }

        .input-field:focus {
            border-color: #61dafb;
            outline: none;
            box-shadow: 0 0 5px #61dafb;
        }

        .error-message {
            color: #ff6b6b;
            font-size: 14px;
            margin-bottom: 20px;
            display: none;
        }

        .button {
            background-color: #61dafb;
            color: #1e1e1e;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .button:hover {
            background-color: #4fb3e6;
        }

        .toggle-button {
            background: none;
            border: none;
            color: #61dafb;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            margin-bottom: 20px;
            text-decoration: underline;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-button:hover {
            color: #4fb3e6;
        }

        .toggle-button span {
            margin-left: 5px;
        }


    </style>
</head>
<body>

    <div class="container">
        <h1>Welcome to Your Co-Browsing Session</h1>
        <h2>We're here to assist you</h2>

        <button class="toggle-button" onclick="toggleInstructions()">
            Show Instructions <span>&#x25BC;</span>
        </button>

        <div class="steps" id="stepsContainer">
            <div class="step-item">
                <span>Step 1:</span>
                <p>Enter your name in the field below.</p>
            </div>
            <div class="step-item">
                <span>Step 2:</span>
                <p>Review the disclaimer about the co-browsing session.</p>
            </div>
            <div class="step-item">
                <span>Step 3:</span>
                <p>Click "Speak to an Agent" to start the session.</p>
            </div>
        </div>

        <p class="disclaimer">You are about to join a live co-browsing session with a representative. During this session, the representative will be able to see your screen and assist you with your needs. Please feel free to share any details or questions you have below.</p>
        <div class="input-group">
            <input type="text" class="input-field" id="nameInput" placeholder="Enter your name...">
            <p class="error-message" id="error-message">Please enter your name before proceeding.</p>
            <button class="button" id="startButton" onclick="validateInput()">Speak to an Agent</button>
        </div>
    </div>

    <script>
        var nameInput = '';
        function toggleInstructions() {
            const stepsContainer = document.getElementById('stepsContainer');
            const toggleButton = document.querySelector('.toggle-button');
            if (stepsContainer.style.display === 'none' || stepsContainer.style.display === '') {
                stepsContainer.style.display = 'flex';
                toggleButton.innerHTML = 'Hide Instructions <span>&#x25B2;</span>';
            } else {
                stepsContainer.style.display = 'none';
                toggleButton.innerHTML = 'Show Instructions <span>&#x25BC;</span>';
            }
        }

        function validateInput() {
            nameInput = document.getElementById('nameInput').value.trim();
            const errorMessage = document.getElementById('error-message');
            if (nameInput === '') {
                errorMessage.style.display = 'block';
            } 
            else {
                console.log("Name input recieved: ",nameInput);
            }
        }

        function fetchInputContent() {
    const nameInput = document.getElementById('nameInput').value.trim();
    console.log(nameInput); // Print the input content to the console
}
    </script>
        <script>
            var showVideoChatButton = false;
            var nicBusNumber        = '4599130';
            var nicChatPOC          = '1605d414-489c-4df4-83b1-334dbeb0ab2c';
            var clusterNiC          = 'b32';
            var surflyWidgetKey     = '134f5fd2ac8842c0a1cd6062818eee74';
            var videoSignalerURL    = "https://home-b32.nice-incontact.com/inContact/Manage/Scripts/Spawn.aspx?scriptName=Surfly_Signaler&bus_no=4599130&scriptId=86019322&skill_no=4137191&p1=&p2=&p3=&p4=&p5=&Guid=602c459a-c935-4539-9fa0-0827ab102c74";
            var surflyModalTitle    = 'Start Videochat';
            var surflyModalBody     = 'Thank you for requesting support through our secure co-browsing platform. The EPB representative assisting you today will not be able to see any open tabs in your browser or sensitive information such as passwords. Would you like to proceed with this session and connect with a local EPB representative?';
        
        let NicHomeURL = "https://home-" + clusterNiC + ".nice-incontact.com";

        var chatSrc = document.createElement("script");
        chatSrc.src = NicHomeURL + "/inContact/ChatClient/js/embed.min.js";

        var head = document.getElementsByTagName("head")[0];
        head.appendChild(chatSrc);

        chatSrc.onload = function () {
            (function (s, u, r, f, l, y) {
                s[f] = s[f] || { init: function () { s[f].q = arguments } };
                l = u.createElement(r); y = u.getElementsByTagName(r)[0]; l.async = 1;
                l.src = 'https://surfly-us.com/surfly.js'; y.parentNode.insertBefore(l, y);
            })
                (window, document, 'script', 'Surfly');
                loadSurfly();
        }


        function signalContact(contactId, followerLink, sessionPin, type) {
            var url = new URL(chatSignalerURL);
            url.searchParams.set('p1', contactId);
            url.searchParams.set('p2', followerLink);
            url.searchParams.set('p3', sessionPin);
            url.searchParams.set('p4', type);
            fetch(url);
        }

        // 
        function updateStudioScript(contactId, type) {
            var url = new URL(chatSignalerURL);
            url.searchParams.set('p1', contactId);
            url.searchParams.set('p2', 'NA');
            url.searchParams.set('p3', `sessionended-${type}`);
            url.searchParams.set('p4', 'NA');
            fetch(url);
        }

        //
        function signalWorkItem(followerLink) {
            var url = new URL(videoSignalerURL);
            url.searchParams.set('p1', 'startWorkItem');
            url.searchParams.set('p2', followerLink);
            fetch(url, {mode:"no-cors"});
        }

        // Finish a workItem
        function endWorkItem(contactId) {
            var url = new URL(videoSignalerURL);
            url.searchParams.set('p1', 'endWorkItem');
            url.searchParams.set('p2', contactId);
            fetch(url);
        }

        // Create Videochat Session
        function createVideochatSession() {
            var contactId = 5240;
            var videochatSession = Surfly.session({
                block_until_agent_joins: false,
                hide_unitl_anget_joins: true,
                videochat_autostart: true,
                start_with_fullscreen_videochat: false,
                videochat_prompt: true,
                start_muted: false,
                url: "https://demo.surfly.com/demo-pages/feature/nice_integration_start_url"
            });
            var surflyMetadata = { "name": nameInput };

            videochatSession.on("session_created", function (session, event) {
                console.log('Waiting for confirmation');
                session.startLeader(null, surflyMetadata);
            }).on("session_started", function (session, event) {
                var surflySessionPin = session.pin;
                var surflyFollowerLink = session.followerLink;
                signalContact(contactId, surflyFollowerLink, surflySessionPin, 'videochat');
                signalWorkItem(surflyFollowerLink);
                signalContact(contactId, surflyFollowerLink, surflySessionPin, 'cobrowse');
                console.log("Videochat session started");
                console.log('Session Pin: ' + surflySessionPin);
            }).on("participant_joined", function (session, event) {
                window.nicVideochatContactId = event.userData.contactId;
                videochatSession.toggleVideochatFullscreen()
                if (event.clientIndex !== 0) {
                                SurflySession.makeHost(1);
                            } else {
                                console.log(event.clientIndex + " joined the session - host not changed");
                            };
            }).on("session_ended", function (session, event) {
                console.log("Videochat session ended");
                endWorkItem(window.nicVideochatContactId);
            }).create();
        }

        // Create Surfly Session
        function createSurflySession(contactId, inviteType) {
            var surflyMetadata = { "name": "Customer" };
            if (inviteType == 'cobrowse') {
                var regularSession = Surfly.session({ block_until_agent_joins: false });
                regularSession.on("session_created", function (session, event) {
                    console.log('Waiting for confirmation');
                    session.startLeader(null, surflyMetadata);
                }).on("session_started", function (session, event) {
                    var surflySessionPin = session.pin;
                    var surflyFollowerLink = session.followerLink;

                    signalContact(contactId, surflyFollowerLink, surflySessionPin, 'cobrowse');

                    var chatDiv = document.getElementById("chat-div-wrap");
                    chatDiv.style.zIndex = "2147483549";
                    console.log('Session Pin: ' + surflySessionPin);
                    console.log('Contact ID: ' + contactId);
                }).on("session_ended", function (session, event) {
                    console.log("Regular session ended, updating Studio");
                    updateStudioScript(contactId, 'cobrowse');
                    createVideochatButton();
                }).create();
            } else if (inviteType == 'videochat') {
                var regularSession = Surfly.session({
                    block_until_agent_joins: false,
                    videochat_autostart: true,
                    start_with_fullscreen_videochat: true,
                    videochat_prompt: false,
                    start_muted: false
                });
                regularSession.on("session_created", function (session, event) {
                    console.log('Waiting for confirmation');
                    session.startLeader(null, surflyMetadata);
                }).on("session_started", function (session, event) {
                    var surflySessionPin = session.pin;
                    var surflyFollowerLink = session.followerLink;

                    signalContact(contactId, surflyFollowerLink, surflySessionPin, 'videochat');

                    var chatDiv = document.getElementById("chat-div-wrap");

                    chatDiv.style.zIndex = "2147483549";
                    console.log('Session Pin: ' + surflySessionPin);
                    console.log('Contact ID: ' + contactId);
                }).on("session_ended", function (session, event) {
                    console.log("Regular session ended, updating Studio");
                    updateStudioScript(contactId, 'videochat');
                    createVideochatButton();
                }).create();
            }
        }

        // 
        function loadSurfly() {
            // Setup settings from API
            var settings = {
                widget_key: surflyWidgetKey,
                auto_restore: false,
                session_start_confirmation: false,
                hidden: false,
                disable_end_redirect: true,
                require_password: false,
                agent_can_request_control: true,
                automated_session_recording_enabled: true,
                end_redirect_enabled: true,
            };

            Surfly.init(settings, function (initResult) {
                if (initResult.success) {
                    if (!Surfly.isInsideSession) {

                        if (localStorage.getItem(nicBusNumber + "-uniquePageId")) {
                            console.log("random: " + localStorage.getItem(nicBusNumber + "-uniquePageId"));
                        } else {
                            let randomString = Math.random().toString(36).substring(7);
                            let dateNow = Date.now();
                            let uniquePageId = randomString + "-" + dateNow;

                            console.log("random: " + uniquePageId);

                            localStorage.setItem(nicBusNumber + "-uniquePageId", uniquePageId);
                        }

                    }
                }
            });
        }
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('startButton').addEventListener('click', fetchInputContent);
    document.getElementById('startButton').addEventListener('click', createVideochatSession);
});
</script>

</body>
</html>

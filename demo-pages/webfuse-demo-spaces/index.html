<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
  <script type="module" src="widget/demo-url-widget.js"></script>
  <link rel="stylesheet" href="widget/demo-url-widget.css">
  <title>Sales Team Demo Spaces</title>
  <style>
    :root {
      --bg: #0b0d12;
      --bg-soft: #11141b;
      --panel: #141826;
      --ink: #e7ecf5;
      --ink-dim: #9aa4b2;
      --brand: #7c5cff;
      --brand-2: #24c7d6;
      --accent: #00e5a8;
      --border: rgba(255, 255, 255, .08);
      --shadow: 0 10px 30px rgba(0, 0, 0, .35);
      --radius: 14px;
      --maxw: 1280px;
      --divider: rgba(255, 255, 255, .08);
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(124, 92, 255, .25), transparent 60%),
        radial-gradient(1000px 600px at 110% 10%, rgba(36, 199, 214, .18), transparent 60%),
        var(--bg);
      background-attachment: fixed;
      background-repeat: no-repeat;
    }

    a {
      color: var(--brand-2);
      text-decoration: none
    }

    .wrap {
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 0 28px
    }

    header {
      position: relative;
      padding: 54px 0 8px;
      border-bottom: 1px solid var(--border)
    }

    h1 {
      font-size: clamp(36px, 4vw, 48px);
      line-height: 1.15;
      margin: 20px 0px;
      text-align: center
    }

    .gradient-ink {
      background: linear-gradient(90deg, var(--brand), var(--brand-2));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent
    }

    .hint {
      text-align: center;
      color: var(--ink-dim);
      font-size: 14px;
      margin: 8px 0 0
    }

    main.wrap {
      padding: 18px 28px 48px
    }

    .entry {
      background: linear-gradient(180deg, rgba(255, 255, 255, .03), rgba(255, 255, 255, .01));
      border: 1px solid var(--ink-dim);
      border-radius: var(--radius);
      padding: 20px;
      margin: 26px 0;
      position: relative;
      box-shadow: var(--shadow)
    }

    .entry::before,
    .entry::after {
      content: "";
      display: block;
      height: 1px;
      background: var(--divider);
      position: absolute;
      left: 10px;
      right: 10px
    }

    .entry::before {
      top: -12px
    }

    .entry::after {
      bottom: -12px
    }

    .titlebar {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: center;
      margin-bottom: 14px
    }

    .title {
      font-weight: 400;
      font-size: 1.5rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis
    }

    .embed-slot {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      min-height: 35px
    }

    .subtitle {
      color: var(--ink-dim);
      margin: 0 0 6px;
      font-size: 14px
    }

    /* 3-up cards per section */
    .three-up {
      display: grid;
      gap: 16px;
      margin-top: 8px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    @media (max-width:980px) {
      .three-up {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width:640px) {
      .three-up {
        grid-template-columns: 1fr;
      }
    }

    .bullet {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 14px;
      background: var(--panel);
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .bullet h4 {
      margin: 0;
      font-size: 1rem
    }

    .bullet p {
      margin: 0;
      color: var(--ink-dim);
      font-size: .95rem;
      line-height: 1.5
    }

    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, .03), rgba(255, 255, 255, .01));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      margin-top: 16px;
    }

    .card h3 {
      margin: 0 0 8px;
      color: var(--ink);
      font-size: 1rem;
    }

    .loading,
    .error {
      color: var(--ink-dim);
      font-size: 14px;
      padding: 10px 0
    }

    .error {
      color: #ff6b6b
    }

    code,
    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: .95rem;
      color: #b9c4ff;
      background: linear-gradient(180deg, rgba(124, 92, 255, .22), rgba(36, 199, 214, .12)), #0f1330;
      border: 1px solid rgba(124, 92, 255, .45);
      padding: .18rem .42rem;
      border-radius: 6px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .03)
    }

    /* —— Spacing above the page heading —— */
    header {
      padding-top: 84px;
    }

    /* was 54px */

    /* —— Section headings: bigger + gradient —— */
    .card h3,
    .entry .title {
      font-weight: 800;
      letter-spacing: .2px;
      background: linear-gradient(90deg, var(--brand), var(--brand-2));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent;
    }

    /* —— Markdown typography: simple, readable text —— */
    /* Applies to rendered markdown inside your .card blocks (from instructions.md, etc.) */
    .card :where(p, li) {
      color: var(--ink);
      font-size: 1rem;
      line-height: 1.7;
    }

    .card :where(ul, ol) {
      margin: 8px 0 10px 20px;
      padding: 0;
    }

    .card li+li {
      margin-top: 4px;
    }

    .card a {
      text-decoration: underline;
    }

    /* Optional: make inline code a touch more subtle inside text blocks */
    .card :where(p, li) code {
      padding: .08rem .34rem;
      border-radius: 6px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid var(--border);
      color: #cfe1ff;
    }

    /* —— Three-up bullets: ensure clean text inside boxes —— */
    .three-up .bullet h4 {
      font-weight: 200;
      line-height: 1;
      color: var(--ink);
      font-size: 1rem;
    }

    .three-up .bullet p {
      color: var(--ink-dim);
      font-size: .97rem;
      line-height: 1.55;
    }

    /* —— Gentle white flashing glow behind embedded buttons —— */
    .embed-slot iframe {
      border-radius: 10px;
      border: 1px solid var(--ink-dim);
      /* soft edges on glow */
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.18);
      animation: pulseGlow 2.8s ease-in-out infinite;
    }

    /* If an embed is not an iframe, still try to glow the first child */
    .embed-slot> :first-child {
      border-radius: 10px;
      height: 28px;
    }

    @keyframes pulseGlow {

      0%,
      100% {
        box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.18);
      }

      50% {
        box-shadow: 0 0 16px 6px rgba(255, 255, 255, 0.14);
      }
    }

    /* Respect reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      .embed-slot iframe {
        animation: none;
      }
    }

    .three-up .bullet h4 {
      color: var(--ink);
      font-size: .9rem;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <header class="wrap">
    <h1><span class="gradient-ink">Sales Team:</span> Demo Space Portal</h1>
    <p class="hint">Import & configure pre-built Webfuse demos</p>
  </header>

  <main class="wrap">
    <div id="demo-url-helper"></div>
    <div id="status" class="loading">Loading demo spaces…</div>
    <div id="entries"></div>
  </main>

  <script>
const IS_PAGES = location.hostname === "demo.surfly.com";
const GITHUB_OWNER  = IS_PAGES ? "" : "JSPOON3R";
const GITHUB_REPO   = IS_PAGES ? "" : "JSPOON3R.github.io";
const GITHUB_BRANCH = "main";

// Your repo-root path to the app folder is the same either way:
const BASE_PATH     = "demo-pages/webfuse-demo-spaces";

    // Helpers
    const esc = (s) => (s || "").replace(/[&<>]/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;' }[c]));
    const ghApiUrl = (path) =>
      `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(GITHUB_BRANCH)}`;
    const ghRawUrl = (path) =>
      `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${encodeURIComponent(GITHUB_BRANCH)}/${path}`;

    /* ---------- Render one entry ---------- */
    async function renderEntry(entryName) {
      const entryRoot = `${BASE_PATH}/Spaces/${entryName}`;

      async function fetchText(path) {
        if (GITHUB_OWNER && GITHUB_REPO) {
          const api = ghApiUrl(path);
          const r = await fetch(api);
          if (!r.ok) throw new Error(`Failed to fetch ${path} from GitHub API`);
          const j = await r.json();
          if (j && j.encoding === "base64" && typeof j.content === "string") {
            return atob(j.content.replace(/\n/g, ""));
          }
          // Fallback to raw when not returned base64 by API
          const r2 = await fetch(ghRawUrl(path));
          if (!r2.ok) throw new Error(`Failed to fetch raw ${path}`);
          return await r2.text();
        }
        // Local static server mode
        const rel = path.replace(`${BASE_PATH}/`, "");
        const r = await fetch(rel);
        if (!r.ok) throw new Error(`Failed to fetch ${rel}`);
        return await r.text();
      }

      // Load markdown + embed
      let infoMd = "", instructionsMd = "", iframeHtml = "";
      try { infoMd = await fetchText(`${entryRoot}/demo-space-info.md`); } catch { }
      try { instructionsMd = await fetchText(`${entryRoot}/instructions.md`); } catch { }
      try { iframeHtml = await fetchText(`${entryRoot}/embed.html`); } catch { }

      const { useCase, icp, keyFeatures, useBullets, icpBullets, keyBullets } = parseInfoMarkdown(infoMd);
      const { setupHtml, demoHtml } = splitInstructions(instructionsMd);

      // Build 3-up grids for each section. If there are no list items, we make cards from paragraphs.
      const useGrid = renderThreeUp(useBullets.length ? useBullets : paragraphize(useCase));
      const icpGrid = renderThreeUp(icpBullets.length ? icpBullets : paragraphize(icp));
      const kfGrid = renderThreeUp(keyBullets.length ? keyBullets : paragraphize(keyFeatures));

      const container = document.createElement("section");
      container.className = "entry";
      const title = entryName.replace(/[-_]/g, " ");

      container.innerHTML = `
    <div class="titlebar">
      <div class="title gradient-ink">${esc(title)}</div>
      <div class="embed-slot">
        ${iframeHtml ? iframeHtml : '<div class="hint">Add <span class="kbd">embed.html</span> to show a button</div>'}
      </div>
    </div>

    <div class="card">
      <h3 class="gradient-ink">Use Case</h3>
      <div class="three-up">${useGrid}</div>
    </div>

    <div class="card">
      <h3 class="gradient-ink">ICP</h3>
      <div class="three-up">${icpGrid}</div>
    </div>

    <div class="card">
      <h3 class="gradient-ink">Key Features &amp; Functionality</h3>
      <div class="three-up">${kfGrid}</div>
    </div>

    <div class="card">
      ${marked.parse(setupHtml || "_(missing **## Set Up** in instructions.md)_")}
    </div>

    <div class="card">
      ${marked.parse(demoHtml || "_(missing **## How to Demo** in instructions.md)_")}
    </div>
  `;
      return container;
    }

    /* ---------- Parse info markdown ---------- */
    function parseInfoMarkdown(md) {
      const out = { useCase: "", icp: "", keyFeatures: "", useBullets: [], icpBullets: [], keyBullets: [] };
      if (!md) return out;

      const lines = md.split(/\r?\n/);
      let section = "use";
      for (const line of lines) {
        if (/^\s*#{1,6}\s*Use\s*Case\b/i.test(line)) { section = "use"; continue; }
        if (/^\s*#{1,6}\s*ICP\b/i.test(line)) { section = "icp"; continue; }
        if (/^\s*#{1,6}\s*Key\s*Features?\s*&?\s*Functionality\b/i.test(line)) { section = "key"; continue; }

        const bullet = line.match(/^\s*[-*]\s+(.*)$/)?.[1];
        if (bullet) {
          if (section === "use") out.useBullets.push(bullet.trim());
          else if (section === "icp") out.icpBullets.push(bullet.trim());
          else out.keyBullets.push(bullet.trim());
        } else {
          if (section === "use") out.useCase += line + "\n";
          else if (section === "icp") out.icp += line + "\n";
          else out.keyFeatures += line + "\n";
        }
      }
      out.useCase = out.useCase.trim();
      out.icp = out.icp.trim();
      out.keyFeatures = out.keyFeatures.trim();
      return out;
    }

    /* ---------- Split instructions into two stacked cards ---------- */
    function splitInstructions(md) {
      if (!md) return { setupHtml: "", demoHtml: "" };
      const parts = md.split(/\r?\n(?=##\s+)/); // split on H2s
      let setup = "", demo = "";
      for (const block of parts) {
        if (/^##\s*Set\s*Up\b/i.test(block)) setup = block;
        if (/^##\s*How\s*to\s*Demo\b/i.test(block)) demo = block;
      }
      return {
        setupHtml: setup ? marked.parse(setup) : "",
        demoHtml: demo ? marked.parse(demo) : ""
      };
    }

    /* ---------- Utilities for 3-up rendering ---------- */
    function paragraphize(text) {
      const chunks = (text || "").trim().split(/\n{2,}/).map(s => s.trim()).filter(Boolean);
      return chunks.length ? chunks : (text ? [text] : []);
    }
    function renderThreeUp(items) {
      // Each item becomes a .bullet card. If an item contains markdown, we parse it lightly.
      return items.map(it => {
        // promote first sentence as a mini heading (nice visual), rest as paragraph
        const firstPeriod = it.indexOf(". ");
        let h = "", p = "";
        if (firstPeriod > 0 && firstPeriod < 120) {
          h = it.slice(0, firstPeriod + 1);
          p = it.slice(firstPeriod + 1);
        } else {
          h = it;
          p = "";
        }
        return `
      <div class="bullet">
        <h4>${esc(h)}</h4>
        ${p ? `<p>${esc(p)}</p>` : ""}
      </div>
    `;
      }).join("");
    }

    /* ---------- Discover entries ---------- */
    async function discoverEntries() {
      const status = document.getElementById("status");
      const entriesHost = document.getElementById("entries");
      try {
        let folders = [];

        if (GITHUB_OWNER && GITHUB_REPO) {
          const api = ghApiUrl(`${BASE_PATH}/Spaces`);
          const r = await fetch(api);
          if (r.ok) {
            const list = await r.json();
            folders = (Array.isArray(list) ? list : []).filter(x => x.type === "dir").map(x => x.name);
          } else {
            throw new Error("GitHub API listing failed");
          }
        } else {
          // Local fallback (serve via http, not file://)
          try {
            const r = await fetch("Spaces/index.json");
            if (r.ok) {
              const j = await r.json();
              folders = Array.isArray(j.folders) ? j.folders : [];
            }
          } catch { }
          if (folders.length === 0) folders = ["Webfuse-Workspace-Import"];
        }

        status.remove();

        for (const folder of folders) {
          try {
            const node = await renderEntry(folder);
            entriesHost.appendChild(node);
          } catch (e) {
            const err = document.createElement("div");
            err.className = "error";
            err.textContent = `Failed to load "${folder}": ${e.message}`;
            entriesHost.appendChild(err);
          }
        }
      } catch (e) {
        status.className = "error";
        status.textContent = "Failed to load spaces: " + e.message;
      }
    }
    discoverEntries();
  </script>
</body>

</html>
<!-- NOTES

SECTIONS:
STARTING UP - add info as listed
API BUILDER - create the flow
EMBED URLS AND BUTTONS - currntly exposing buttons too early. Must update url visuals first

WORKFLOW OF PAGE
- see info about the embed API
- click to create an api request
- hide api request button once it is clicked
- show api builder: blank call on screen with POST, URL and BODY, who are you box, api key box (info about each input and what it means). Include big 'call api' button on screen but mention this can't be clicked until we hav the right info.
- update API visual when who are you selected
- update API visual the api key added
- when api is called, display response body and status code
- when status code - 200, expose the embed section
- show all the URLs for embed API without access code 
- text box to enter access code from response
- update URL visuals with acess code (and the iframes in the back end) / display generate iframe buttons
- done



-->





<!doctype html>
<html>

<head>
   <!-- <link rel="stylesheet" href="surfly.css"> -->

    <title>EMBED API</title>


    <!--JS CODE-->

    <!--STARTING UP: START-->
    <!--reveal the api builder button start-->
    <script>
        function Expose_api_view() {
            document.getElementById('api_builder').style.display = "block";
        }
    </script>
    <!--reveal the api builder button end-->
    <!--STARTING UP: END-->

    <!--API BUILDER: START-->
    <!--who are you dropdown start-->
    <script>
        /* When the user clicks on the button,
        toggle between hiding and showing the dropdown content */
        function dropdown() {
            document.getElementById("myDropdown").classList.toggle("show");
        }

        // Close the dropdown menu if the user clicks outside of it
        window.onclick = function (event) {
            if (!event.target.matches('.dropbtn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                var i;
                for (i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
    <!--who are you dropdown end-->
    <!--store api key entry/update display start-->
    <script>
        function collectApiKey() {
            var key_input = document.getElementById("apikey_input_box").value
            localStorage.setItem('stored_key', key_input)
            console.log("API_KEY submitted: " + key_input)
            console.log("Key stored locally: " + localStorage.getItem('stored_key'))
        }
    </script>
  <!--ADD LIST ITEM UPDATE TO THE ABOVE-->


    <!--store api key entry/update display end-->






<!-- function to detect both api key and body have been added to request and expose call api button-->


    <!--call api start-->
    <script>
        let stored_key = localStorage.getItem('stored_key')

        function callAPI() {
            const response = fetch("https://surfly.com/v2/agents/access-token/?api_key=" + stored_key, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: `{
    "agent_id": 321854,
    "email": "john@surfly.com",
    "name": "John",
    "role": "admin",
    "force_new": false
}`,
            })
                .then(response => response.json())
                .then(response => console.log(JSON.stringify(response)))

        }
    </script>
    <!--call api end-->
    <!--API BUILDER: END-->

    <!--STEP 2. EMBED URLS-->
    <!-- expose urls with blank tokens start-->

    <!-- expose urls with blank tokens end-->



    <!--EXPOSE TOKEN INPUT-->
    <script>
        function Exposetokenbutton() {
            document.getElementById('token_button_div').style.display = "block";
        }
    </script>

    <!--ONCE TOKEN IS RECIEVED:-->

    <!--STORE AGENT_TOKEN-->
    <script>


        function returntoken() {
            var token_input = document.getElementById("token_input_box").value
            localStorage.setItem('stored_token', token_input)
            console.log("AGENT_TOKEN submitted: " + token_input)
            console.log("Token stored locally: " + localStorage.getItem('stored_token'))
        }
    </script>


    <!--'APPLY AGENT_TOKEN TO IFRAME' FUNCTIONS-->
    <script>

        let stored_token = localStorage.getItem('stored_token')

        function updateurl_startsession() {
            let start_session = document.getElementById("start_session");
            let url_string = "https://app.surfly.com/embed/start/";
            var url_token = localStorage.getItem('stored_token')
            let adsURL = url_string + "?agent_token=" + url_token;
            console.log("iFrame URL = " + adsURL);
            start_session.src = adsURL;
        }

        function updateurl_supportqueue() {
            let start_session = document.getElementById("support_queue");
            let url_string = "https://app.surfly.com/embed/queue/";
            var url_token = localStorage.getItem('stored_token')
            let adsURL = url_string + "?agent_token=" + url_token;
            console.log("iFrame URL = " + adsURL);
            start_session.src = adsURL;
        }

        function updateurl_sessionhistory() {
            let start_session = document.getElementById("session_history");
            let url_string = "https://app.surfly.com/embed/history/";
            var url_token = localStorage.getItem('stored_token')
            let adsURL = url_string + "?agent_token=" + url_token;
            console.log("iFrame URL = " + adsURL);
            start_session.src = adsURL;
        }

        function updateurl_companyoptions() {
            let start_session = document.getElementById("company_options");
            let url_string = "https://app.surfly.com/embed/options/";
            var url_token = localStorage.getItem('stored_token')
            let adsURL = url_string + "?agent_token=" + url_token;
            console.log("iFrame URL = " + adsURL);
            start_session.src = adsURL;
        }
    </script>

    <!--EXPOSE EMBED URL SECTION-->
    <script>
        function ExposeEmbedUrls() {
            document.getElementById('generate_urls_div').style.display = "block";
        }
    </script>
    <!--EXPOSE IFRAME-->
    <!--EXPOSE IFRAME FUNCTIONS START-->
    <!--EXPOSE SESSION iFRAME-->
    <script>
        function Exposeiframes_session() {
            document.getElementById('iframe_div_session').style.display = "block";
        }
    </script>
    <!--EXPOSE SUPPORT iFRAME-->
    <script>
        function Exposeiframes_support() {
            document.getElementById('iframe_div_support').style.display = "block";
        }
    </script>
    <!--EXPOSE HISTORY iFRAME-->
    <script>
        function Exposeiframes_history() {
            document.getElementById('iframe_div_history').style.display = "block";
        }
    </script>
    <!--EXPOSE COMPANY iFRAME-->
    <script>
        function Exposeiframes_company() {
            document.getElementById('iframe_div_company').style.display = "block";
        }
    </script>
    <!--EXPOSE IFRAME FUNCTIONS END-->
</head>





<body>
    <div class="maxpagewidth">
    <!--STARTING UP: START-->
    <h1>Implementing Surfly's Embedded iFrames</h1>
    <h2>Steps to Implementation</h2>
    <!--

here we will explain the embed API

define iframes

explain that URLs need access tokens and why

Explain how we get an access token: api
-->
<p>Before you can use the Embed API, you will need your unique ACCESS_TOKEN. This is necessary because...</p>


    <!--Get started button start (clicking this will expose the API builder)-->
    <button class="button" onclick=Expose_api_view()><span>Create an API Request</span></button>
    <!--Get started button start-->


    <!--API builder: start-->
    <!--API div start-->
    <div id="api_builder" style="display:none;">
       
<div id="api_request_and_response" class="api_request_and_response">
<div id="entire_api_request" class="api_call">
    <h3>Request</h3>
    <div class="api_url">
        <ul>
            <li class="post">POST </li>
            <li class="api_url">https://surfly.com/v2/agents/access-token/?</li>
            <li class="api_url_key">YOUR_API_KEY_GOES_HERE</li>
        </div>
        <div class="api_body">
            <p>{
                "agent_id": ,
                "email": "",
                "name": "",
                "role": "",
                "force_new": false
                }</p>
          </ul>
        </div>
        </div>
    <div id="entire_api_response" class="api_call">
        <h3>Response</h3>
    </div>
</div>
<div id="all_api_input" class="all_api_input">
        <p>To generate it, you need to call the REST API. The call needed is above, we just need some details:</p>

        <!--Who are you?-->
        <!--Create a drop down of the whole team and apply their values in a body-->
        <h2>Who are you?</h2>
        <p>The body of the request requires your email address, name, role and agent ID. Select your name to populate
            automatically</p>

        <div class="dropdown">

            <button class="button" onclick="" class="dropbtn">Who are you?</button>
            <div id="myDropdown" class="dropdown-content">
                <a href="#">Tom</a>
                <a href="#">Ayush</a>
                <a href="#">Filipa</a>
                <a href="#">Keith</a>

            </div>
        </div>
        <!--Get token-->
        <!--key-->
        <h2>Enter your API Key</h2>
        <p>We need your API Key to authenticate the request. Find it on the Surfly dashboard and enter it below.</p>

        <input id="apikey_input_box" type="text" placeholder="Enter API Key here...">
        <button class="button" onclick=collectApiKey()>Apply API Key to Request</button>
    </div>
</div><!--API div end-->

   <!--when all inputs are completed, we can expose the button to call the API-->
<div id="inputs_complete" style="display:none;">
        <h2>Looks like we have everythng we need. The API request is now ready to go. </h2>
        <p>Click to send a request to the REST API for your AGENT_TOKEN</p>
        <button class="button" onclick=collectApiKey();callAPI()>Call the API</button>
  <!--show response so they can copy/paste the agent token-->
    </div>




  <!--Upon 200 response, show button to begin the next stage (Exposetokenbutton)-->
    <div id="200_response" style="display:none;">
        <h2>Success! </h2>
        <p>Now that your have your agent token - click to go to the next step</p>
        <button class="button" onclick=Exposetokenbutton()>Create Embed API URLs</button>

    </div>
    
    <!--API builder: end-->




    <!--When SUBMIT is clicked, EMBED URLS AND BUTTONS begins-->


    <!--EMBED URLS AND BUTTONS: START-->

        <!--Set Token (display this only after a 200 response from the API)-->
        <div id="token_button_div" style="display:none;">
            <h2>AGENT_TOKEN </h2>
            <p>Now copy your agent token and add it to the embed API URLs</p>

            <p>Enter your AGENT_TOKEN and click submit to generate Surfly embedded iFrames with your unique access
                token. This will ensure each iFrame links to your Surfly account</p>

            <input id="token_input_box" type="text" placeholder="Enter token here...">
            <button class="button"
                onclick=returntoken();updateurl_startsession();updateurl_supportqueue();updateurl_sessionhistory();updateurl_companyoptions();ExposeEmbedUrls()>Submit</button>
        </div>



    <!--generate URLS div start-->
    <div id="generate_urls_div" style="display:none;">
        <h2>2. Explore the Different Embedded the iFrames</h2>

        <!--SESSION-->
        <!--Generate Session iFrame start-->
        <h2>SESSION URL</h2>
        <div></div>
        <button class="button" onclick=Exposeiframes_session()>Generate Session iFrame</button>
        <!--Generate Session iFrame end-->
        <!--Session ifrmae div start-->
        <div id="iframe_div_session" style="display:none;">
            <h3>1. Start a Session (Outbound)</h3>

            <iframe id="start_session" width="1024" height="768"
                src="https://app.surfly.com/embed/start/?agent_token=`AGENT_TOKEN`"
                allow="autoplay *; camera *; microphone *; display-capture *; geolocation *;">
            </iframe>
        </div>
        <!--Session iframe div end-->

        <!--SUPPORT-->
        <!--Generate Support iFrame start-->
        <h2>SUPPORT URL</h2>
        <div></div>
        <button class="button" onclick=Exposeiframes_support()>Generate Support iFrame</button>
        <!--Generate Support iFrame end-->
        <!--Support iframae div start-->
        <div id="iframe_div_support" style="display:none;">
            <h3>2. View Support Queue</h3>

            <iframe id="support_queue" width="1024" height="768"
                src="https://app.surfly.com/embed/queue/?agent_token=`AGENT_TOKEN`"
                allow="autoplay *; camera *; microphone *; display-capture *; geolocation *;">
            </iframe>
        </div>
        <!--Support ifrmae div end-->

        <!--HISTORY-->
        <!--Generate History iFrame start-->
        <h2>HISTORY URL</h2>
        <div></div>
        <button class="button" onclick=Exposeiframes_history()>Generate History iFrame</button>
        <!--Generate History iFrame end-->
        <!--History ifrmae div start-->
        <div id="iframe_div_history" style="display:none;">
            <h3>3. View Session History</h3>

            <iframe id="session_history" width="1024" height="768"
                src="https://app.surfly.com/embed/queue/?agent_token=`AGENT_TOKEN`"
                allow="autoplay *; camera *; microphone *; display-capture *; geolocation *;">
            </iframe>
        </div>
        <!--History ifrmae div end-->

        <!--COMPANY-->
        <!--Generate Company iFrame start-->
        <h2>COMPANY URL</h2>
        <div></div>
        <button class="button"onclick=Exposeiframes_company()>Generate Company iFrame</button>
        <!--Generate Company iFrame end-->
        <!--Company ifrmae div start-->
        <div id="iframe_div_company" style="display:none;">
            <h3>4. View Company Options</h3>

            <iframe id="company_options" width="1024" height="768"
                src="https://app.surfly.com/embed/options/?agent_token=`AGENT_TOKEN`"
                allow="autoplay *; camera *; microphone *; display-capture *; geolocation *;">
            </iframe>
        </div>
        <!--Company ifrmae div end-->
    </div>
    <!--generate URLS div end-->
    <!--EMBED URLS AND BUTTONS: END-->

</div>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Godigit Cobrowse</title>
    <link rel="shortcut icon" type="image/x-icon" href="https://d2h44aw7l5xdvz.cloudfront.net/assets/img/fav.ico">
    <style>
        body {
            background:
                linear-gradient(rgba(255, 255, 255, 0.9),
                    rgba(255, 255, 255, 0.9)),
                url("https://www.godigit.com/content/dam/godigit/directportal/website-header/resources-icons.webp");
            background-repeat: no-repeat;
            background-size: cover;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: #000;
            font: normal 400 2.4rem / 120% "Muli", "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
    </style>
</head>

<body>
    <div id="name-container" style="text-align: center;">
        <label for="name-input" style="font-size: 24px; color: black;">Enter your name</label><br>
        <input id="name-input" type="text"
            style="padding: 12px; width: 280px; font-size: 18px; border: 1px solid #000; border-radius: 6px;"><br>
        <button id="name-submit"
            style="margin-top: 10px; padding: 12px 24px; background-color: #FFBB00; border: none; border-radius: 6px; font-size: 18px; color: black;">Submit</button>
        <div id="name-error" style="color: red; font-size: 14px; margin-top: 10px;"></div>
    </div>
    <script>

        // Load Surfly JS
        // https://docs.surfly.com/surfly/javascript-api/quickstart
        (function (s, u, r, f, l, y) {
            s[f] = s[f] || { init: function () { s[f].q = arguments } };
            l = u.createElement(r); y = u.getElementsByTagName(r)[0]; l.async = 1;
            l.src = 'https://surfly.com/surfly.js'; y.parentNode.insertBefore(l, y);
        })
            (window, document, 'script', 'Surfly');


        // Page variables
        // Get the query parameter from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const queryParameter = urlParams.get('url');
        // Store customer name for use in Surfly metadata
        let customerName = "";

        // Handle name submission
        document.getElementById("name-submit").addEventListener("click", function () {
            const nameInput = document.getElementById("name-input").value.trim();
            const errorBox = document.getElementById("name-error");
            // Ensure name is given
            if (nameInput === "") {
                errorBox.innerText = "Please enter your name.";
                return;
            }

            errorBox.innerText = "";
            customerName = nameInput;
            //Start Surfly session when conditions are met
            startCorbowsing();
        });


        // Surfly global setting (set in dashboard) will be used unless overridden here
        // See all session options: https://docs.surfly.com/surfly/session-options/
        var settings = {
            widget_key: "178ae961b9134d0680eb2cb1605c35b9",
            hide_until_agent_joins: false,
            block_until_agent_joins: false,
            admission_enabled: false,
            start_with_loading_screen: false,
            hide_session_ui: false,
            url: `${queryParameter}`,
            session_autorestore_enabled: false,
            start_with_invite_modal: false,
            videochat_enabled: true,
            hide_element_by_selector: "#registration-search",
            start_with_videochat_on: true,
            follower_redirect_url: "https://www.godigit.com",
            leader_redirect_url: "https://www.godigit.com",
            tags: [
                "custom-website-landing-page"
            ],
            blocklist: "[{\"pattern\": \"^https?://[\\\\w\\\\.]*facebook\\\\.com\",\"redirect\": \"https://demo.surfly.com/blocked.html\"}]"

        };

        // Display the overlay when the Session content has loaded
        // This prevents the customer from starting before the agent arrives
        function ensureAgentWaitOverlayStyles() {
            if (document.getElementById("agent-wait-overlay-styles")) {
                return;
            }
            var style = document.createElement("style");
            style.id = "agent-wait-overlay-styles";
            style.textContent = `
                @keyframes pulseOpacity {
                    0% { opacity: 0.9; }
                    50% { opacity: 0.8; }
                    100% { opacity: 0.9; }
                }
            `;
            document.head.appendChild(style);
        }

        function showAgentWaitOverlay() {
            ensureAgentWaitOverlayStyles();
            var overlay = document.getElementById("agent-wait-overlay");
            if (!overlay) {
                overlay = document.createElement("div");
                overlay.id = "agent-wait-overlay";
                overlay.textContent = "Please wait for the Agent to join you";
                overlay.style.position = "fixed";
                overlay.style.left = "50%";
                overlay.style.width = "90vw";
                overlay.style.bottom = "5vh";
                overlay.style.transform = "translateX(-50%)";
                overlay.style.padding = "27px 24px";
                overlay.style.background = "white";
                overlay.style.borderRadius = "8px";
                overlay.style.display = "flex";
                overlay.style.border = "4px solid #FFBB00";
                overlay.style.alignItems = "center";
                overlay.style.justifyContent = "center";
                overlay.style.textAlign = "center";
                overlay.style.fontSize = "4rem";
                overlay.style.color = "black";
                overlay.style.zIndex = "2147483647";
                overlay.style.pointerEvents = "none";
                overlay.style.animation = "pulseOpacity 2s ease-in-out infinite";
                document.body.appendChild(overlay);
            } else {
                overlay.style.display = "flex";
            }
        }
        // Hide the overlay when the Agent joins the call. 
        function hideAgentWaitOverlay() {
            var overlay = document.getElementById("agent-wait-overlay");
            if (overlay) {
                overlay.style.display = "none";
            }
        }



        function startCorbowsing() {
            // Surfly.init() must be called before any other API call
            Surfly.init(settings, function (init) {
                if (init.success && !Surfly.isInsideSession) {
                    Surfly.session()
                        .on("session_created", function (session, event) {
                            // Opportunity to alert other systems here if needed
                        })
                        .on("session_loaded", function (session, event) {
                            // Opportunity to alert other systems here if needed
                            showAgentWaitOverlay();
                        })
                        .on('participant_joined', function (session, event) {
                            console.log('Agent has joined with client index: ', event.clientIndex);
                            hideAgentWaitOverlay();
                        })
                        .startLeader(null,
                            {
                                "Customer": customerName
                            });
                }
            });
        }
    </script>

</body>

</html>
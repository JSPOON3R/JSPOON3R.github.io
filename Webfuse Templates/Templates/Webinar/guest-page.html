<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webinar: Guest</title>
    <link rel="icon" type="image/png"
        href="https://cdn.prod.website-files.com/66fa5c211b77ce188d5275f6/6752cfb0d2935e66e4d7d1a1_favicon-webfuse.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap">
    <style>
        :root {
            --background-color--background-primary: var(--base-color-brand--dark);
            --background-color--dark-blue: #0a205e;
            --background-color--dark-green: #1f3c30;
            --base-color-brand--off-white: #f7f7f7;
            --base-color-brand--light-gray: silver;
            --link-color--link-alternate: var(--base-color-brand--off-white);
            --radius--radius-main: 1rem;
            --base-color-brand--blue: #3d93ef;
            --base-color-brand--purple: #4d65ff;
            --base-color-brand--dark: #0b0b0b;
            --base-color-neutral--black: black;
            --base-color-neutral--white: white;
            --radius--radius-round: 100vw;
            --text-color--text-alternate: var(--base-color-brand--dark);
            --text-color--text-error: var(--base-color-system--error-red);
            --base-color-system--success-green: #027a48;
            --base-color-system--success-green-light: #ecfdf3;
            --base-color-system--error-red: #b42318;
            --base-color-system--error-red-light: #fef3f2;
            --radius--radius-large: 1.5rem;
            --background-color--background-success: var(--base-color-system--success-green-light);
            --background-color--background-error: var(--base-color-system--error-red-light);
            --border-color--border-alternate: var(--base-color-brand--off-white);
            --text-color--text-success: var(--base-color-system--success-green);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Inter, sans-serif;
            background: black;
            color: var(--base-color-brand--off-white);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            overflow: hidden;
        }

        .top-container {
            width: 93%;
            display: flex;
            height: 5%;
        }

        .body-container {
            display: flex;
            position: fixed;
            top: 5%;
            width: 95%;
            height: 94%;
            gap: 10px;
        }

        .header {
            width: 100%;
            text-align: start;
            font-size: 1.5rem;
            font-weight: lighter;
            position: relative;
            align-self: center;
            z-index: 2;
        }

        .counter {
            width: 100%;
            text-align: end;
            font-size: 1.6rem;
            font-weight: lighter;
            position: relative;
            display: flex;
            z-index: 2;
            flex-direction: row;
            align-items: center;
            justify-content: flex-end;
        }

        .user-icon {
            width: 2rem;
            height: auto;
            animation: spin-pause 3s ease-in-out infinite;
            color: var(--base-color-brand--blue);
        }

        .blue {
            color: var(--base-color-brand--blue);
            font-weight: bold;
        }

        .waiting-iframe-container,
        .session-iframe-container {
            border: 3px solid white;
            border-radius: var(--radius--radius-main);
            overflow: hidden;
            position: fixed;
            top: 5%;
            left: 2.5%;
            width: 70%;
            height: 94%;
            background: var(--background-color--background-alternate);
        }

        .session-iframe-container {
            z-index: -1;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: var(--base-color-neutral--white);
        }

        .chat-container {
            /* Adjusted for better scaling */
            background-color: black;
            border: 3px solid white;
            border-radius: var(--radius--radius-main);
            display: flex;
            flex-direction: column;
            /* Ensures chat messages and input align properly */
            position: fixed;
            overflow: hidden;
            top: 5%;
            width: 23%;
            height: 94%;
            right: 2.5%;
            max-height: 100vh;
            /* Ensures it doesnâ€™t overflow */
        }

        /* Chat messages area */
        .chat-messages {
            flex-grow: 1;
            /* Allows chat messages to take up available space */
            overflow-y: auto;
            background-color: black;
            display: flex;
            flex-direction: column;
            padding: 10px;
            height: auto;
        }

        /* Ensure the chat messages area scrolls smoothly */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        /* Individual chat message */
        .message {
            background-color: #1e1e1e;
            color: white;
            font-size: .8rem;
            padding: 10px 14px;
            border-radius: 12px;
            margin: 5px 10px;
            width: 75%;
            word-wrap: break-word;
        }

        /* Alternating message styling */
        .message.user {
            background-color: #007bff;
            align-self: flex-end;
        }

        .message.bot {
            background-color: #444;
            align-self: flex-start;
        }

        /* Input area */
        .chat-input-container {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 10px;
            background: black;
            max-width: 100%;
            height: 50px;
            border-top: 2px solid white;
        }

        .chat-input {
            width: 70%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background-color: #222;
            color: white;
        }

        .chat-send {
            width: 30%;
            padding: 12px 0px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s ease-in-out;
        }

        .chat-send:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div class="top-container">
        <div class="header">
            Webinar: <span class="blue">Guest</span>
        </div>
        <div class="counter">
            <p id="participant-count-display">123
            </p>
            <svg class="user-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="30" height="30"
                fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd"
                    d="M12 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4h-4Z"
                    clip-rule="evenodd" />
            </svg>
        </div>
    </div>
    <div class="body-container">
        <div class="waiting-iframe-container">
            <iframe id="waitingFrame"
                src="https://demo.surfly.com/Webfuse%20Templates/Templates/Webinar/waiting-room.html"></iframe>
        </div>
        <div class="session-iframe-container">
            <iframe id="sessionFrame" src=""></iframe>
        </div>
        <div class="chat-container">
            <!-- Chat Messages Display -->
            <div class="chat-messages" id="chatMessages"></div>

            <!-- Chat Input and Send Button -->
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Type a message...">
                <button class="chat-send" id="sendMessage">Send</button>
            </div>
        </div>
    </div>
</body>
<script>
    const channel = new BroadcastChannel("webinar_channel");

    channel.addEventListener("message", (event) => {
        const { type, url } = event.data;

        if (type === "UPDATE_IFRAME" && url) {
            console.log("Received new webinar URL:", url);

            // Update the iframe dynamically
            document.getElementById("webinarFrame").src = url;
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const chatMessages = document.getElementById("chatMessages");
        const chatInput = document.getElementById("chatInput");
        const sendMessage = document.getElementById("sendMessage");



        function addMessage(text) {
            if (text.trim() === "") return; // Ignore empty messages
            const messageElement = document.createElement("div");
            messageElement.classList.add("message");
            messageElement.textContent = text;
            chatMessages.appendChild(messageElement);

            // Auto-scroll to the latest message
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Clear input field
            chatInput.value = "";
        }

        sendMessage.addEventListener("click", () => {
            addMessage(chatInput.value);
        });

        chatInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") addMessage(chatInput.value);
        });
    });
</script>
<script>
    const sessionFrame = document.getElementById("sessionFrame");
    const sessionFrameContainer = document.querySelector(".session-iframe-container");
    (function (w, e, b, f, u, s) {
        w[f] = w[f] || {
            initSpace: function () {
                return new Promise(resolve => {
                    w[f].q = arguments;
                    w[f].resolve = resolve;
                });
            },
        };
        u = e.createElement(b);
        s = e.getElementsByTagName(b)[0];
        u.async = 1;
        u.src = 'https://surfly.online/surfly.js';
        s.parentNode.insertBefore(u, s);
    })(window, document, 'script', 'Webfuse');



    Webfuse.initSpace(
        'wk_IGKyVolVK9ycsqCgSUoCjfc9NSsBvYXz',
        524,
        {}, // Integration Settings (optional)
    )

        .then(async space => {
            console.log('Space:', space);
            console.log('Space ID:', space.id);
            console.log('Space slug:', space.slug);

            // console.log('Space:', space._webfuse._allsessions._paused);

            const session = space.session();
            const activeSession = Webfuse.listSessions()[0];

            // Start the session
            await session.create()
            sessionFrame.src = session.followerLink;
        })
        .catch(error => {
            console.error('Failed:', error);
        })


    window.addEventListener('message', (event) => {
        console.log("window listener received a message:", event);
        console.log("Message data:", event.data);
        console.log("Message origin:", event.origin);
        if (event.data.params.clientIndex === 1) {
            if (sessionFrameContainer) {
                sessionFrameContainer.style.zIndex = "1";
            } else {
                console.error("sessionFrameContainer not found in the DOM!");
            }
        }
    });


    window.addEventListener("message", (event) => {
    if (event.data && event.data.type === "log") {
        console.log("[IFRAME LOG]:", event.data.message);
    }
});



let WebinarStart = localStorage.getItem("webinarStart");
let checkingInterval;
const checkFrequency = 1000;

function startChecking() {
    checkingInterval = setInterval(() => {
        WebinarStart = localStorage.getItem("webinarStart");

        if (WebinarStart) {
            console.log("Webinar Started: Detected localStorage change.");
            clearInterval(checkingInterval);
            if (sessionFrameContainer) {
                sessionFrameContainer.style.zIndex = "1";
            } else {
                console.error("sessionFrameContainer not found in the DOM!");
            }
        }
        else {
            console.log("waiting for webinar host...")
        }
    }, checkFrequency);
}

// Start polling
startChecking();

</script>

</html>